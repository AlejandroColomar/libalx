#!/bin/bash
################################################################################
#	Copyright (C) 2019	Alejandro Colomar Andr√©s		       #
#	SPDX-License-Identifier:	LGPL-2.0-only			       #
################################################################################
#
# Run a series of test programs and print their status
#
################################################################################


################################################################################
#	constants							       #
################################################################################
BOLD='\033[1m'
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
COLOR_OFF='\033[0m'


################################################################################
#	functions							       #
################################################################################
find_tests()
{

	tests="$(find . -type f -name '*test')"
}

run_test()
{
	local	cmd=$1
	local	ret

	eval	"${cmd}"
	ret=$?
	if ((!${ret})); then
		printf	"  ${GREEN}${BOLD}[OK]${COLOR_OFF}	%s\n"	"${cmd}"
	else
		printf	" ${RED}${BOLD}[FAIL]${COLOR_OFF}	%s\n"	"${cmd}"
		printf	"\t\t${YELLOW}exit status: %i${COLOR_OFF}\n"	"${ret}"
	fi
}


################################################################################
#	main								       #
################################################################################
find_tests

for i in ${tests}; do
	run_test	${i}
done


################################################################################
#	end of file							       #
################################################################################
