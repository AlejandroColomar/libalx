/******************************************************************************
 *	Copyright (C) 2020	Alejandro Colomar Andr√©s		      *
 *	SPDX-License-Identifier:	BSD-2-Clause			      *
 ******************************************************************************/


/******************************************************************************
 ******* headers **************************************************************
 ******************************************************************************/
#include "libalx/nix/ucat/ucat.h"

#include <errno.h>
#include <stddef.h>
#include <stdio.h>
#include <string.h>

#include "libalx/base/compiler/size.h"
#include "libalx/extra/curl/fcurl/fclose.h"
#include "libalx/extra/curl/fcurl/fopen.h"
#include "libalx/extra/curl/fcurl/fread.h"
#include "libalx/extra/curl/fcurl/URL_FILE.h"


/******************************************************************************
 ******* macros ***************************************************************
 ******************************************************************************/


/******************************************************************************
 ******* enum / struct / union ************************************************
 ******************************************************************************/


/******************************************************************************
 ******* static prototypes ****************************************************
 ******************************************************************************/


/******************************************************************************
 ******* global functions *****************************************************
 ******************************************************************************/
int	alx_nix_ucat	(const char *url)
{
	ALX_URL_FILE	*istream;

	if (!url  ||  !strcmp(url, "-")) {
		istream	= alx_url_stdin;
	} else {
		istream	= alx_url_fopen(url, "r");
		if (!istream)
			return	errno;
	}

	alx_nix_ucat__(stdout, istream);

	if (istream != alx_url_stdin)
		return	alx_url_fclose(istream);

	return	0;
}

void	alx_nix_ucat__	(FILE *restrict ostream, ALX_URL_FILE *restrict istream)
{
	size_t	n;
	char	buf[BUFSIZ];

	do {
		n	= alx_url_fread(buf, 1, ARRAY_SIZE(buf), istream);
		fwrite(buf, 1, n, ostream);
	} while (n);
}


/******************************************************************************
 ******* static function definitions ******************************************
 ******************************************************************************/


/******************************************************************************
 ******* end of file **********************************************************
 ******************************************************************************/

