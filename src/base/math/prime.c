/******************************************************************************
 *	Copyright (C) 2019	Alejandro Colomar Andr√©s		      *
 *	SPDX-License-Identifier:	LGPL-2.0-only			      *
 ******************************************************************************/


/******************************************************************************
 ******* headers **************************************************************
 ******************************************************************************/
#include "libalx/base/math/prime.h"

#include <math.h>
#include <stdbool.h>
#include <stddef.h>
#include <stdint.h>

#include "libalx/base/stdlib/search.h"


/******************************************************************************
 ******* macros ***************************************************************
 ******************************************************************************/


/******************************************************************************
 ******* enums ****************************************************************
 ******************************************************************************/


/******************************************************************************
 ******* structs / unions *****************************************************
 ******************************************************************************/


/******************************************************************************
 ******* variables ************************************************************
 ******************************************************************************/
/* global --------------------------------------------------------------------*/
const	int8_t		alx_prime_s8 [PRIME_NUMBERS_QTY_S8] = {
		2, 3, 5, 7, 11,			13, 17, 19, 23, 29,
		31, 37, 41, 43, 47,		53, 59, 61, 67, 71,
		73, 79, 83, 89, 97,		101, 103, 107, 109, 113,
		127
	};
const	uint8_t		alx_prime_u8 [PRIME_NUMBERS_QTY_U8] = {
		2, 3, 5, 7, 11,			13, 17, 19, 23, 29,
		31, 37, 41, 43, 47,		53, 59, 61, 67, 71,
		73, 79, 83, 89, 97,		101, 103, 107, 109, 113,
		127, 131, 137, 139, 149,	151, 157, 163, 167, 173,
		179, 181, 191, 193, 197,	199, 211, 223, 227, 229,
		233, 239, 241, 251
	};
	int16_t		alx_prime_s16 [PRIME_NUMBERS_QTY_S16];
	uint16_t	alx_prime_u16 [PRIME_NUMBERS_QTY_U16];
/* static --------------------------------------------------------------------*/


/******************************************************************************
 ******* static functions (prototypes) ****************************************
 ******************************************************************************/
static bool	is_prime_s16	(int n);
static bool	is_prime_u16	(unsigned n);


/******************************************************************************
 ******* global functions *****************************************************
 ******************************************************************************/
void	alx_prime_s16_init	(void)
{
	ptrdiff_t	i;

	i	= 0;
	alx_prime_s16[i++]	= 2;

	for (int n = 3; n < INT16_MAX; n++) {
		if (is_prime_s16(n))
			alx_prime_s16[i++]	= n;
	}
}

void	alx_prime_u16_init	(void)
{
	ptrdiff_t	i;

	i	= 0;
	alx_prime_u16[i++]	= 2;

	for (unsigned n = 3; n < UINT16_MAX; n++) {
		if (is_prime_u16(n))
			alx_prime_u16[i++]	= n;
	}
}



/******************************************************************************
 ******* static functions (definitions) ***************************************
 ******************************************************************************/
static bool	is_prime_s16	(int n)
{
	int	sqrt_n;

	sqrt_n	= sqrt(n) + 1;

	for (ptrdiff_t i = 0; (alx_prime_s16[i] <= sqrt_n) &&
					(i < PRIME_NUMBERS_QTY_S16); i++) {
		if (!(n % alx_prime_s16[i]))
			return	false;
	}

	return	true;
}

static bool	is_prime_u16	(unsigned n)
{
	int	sqrt_n;

	sqrt_n	= sqrt(n) + 1;

	for (ptrdiff_t i = 0; (alx_prime_s16[i] <= sqrt_n) &&
					(i < PRIME_NUMBERS_QTY_U16); i++) {
		if (!(n % alx_prime_s16[i]))
			return	false;
	}

	return	true;
}


/******************************************************************************
 ******* end of file **********************************************************
 ******************************************************************************/
