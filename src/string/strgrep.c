/******************************************************************************
 *	Copyright (C) 2019	Alejandro Colomar Andr√©s		      *
 *	SPDX-License-Identifier:	LGPL-2.0-only			      *
 ******************************************************************************/


/******************************************************************************
 ******* headers **************************************************************
 ******************************************************************************/
#include "libalx/string/strgrep.h"

#include <stdbool.h>
#include <stddef.h>
#include <string.h>

#include <sys/types.h>

#include "libalx/string/strchr.h"


/******************************************************************************
 ******* macros ***************************************************************
 ******************************************************************************/


/******************************************************************************
 ******* enums ****************************************************************
 ******************************************************************************/


/******************************************************************************
 ******* structs / unions *****************************************************
 ******************************************************************************/


/******************************************************************************
 ******* variables ************************************************************
 ******************************************************************************/


/******************************************************************************
 ******* static functions (prototypes) ****************************************
 ******************************************************************************/


/******************************************************************************
 ******* global functions *****************************************************
 ******************************************************************************/
ssize_t	alx_strlfgrep	(ssize_t buff_size,
					char dest[restrict buff_size],
					const char src[restrict buff_size],
					const char *restrict pattern)
{
	ssize_t	pos_dest;
	ssize_t	pos_src;
	ssize_t	line_len;

	if (!buff_size)
		return	0;

	pos_dest	= 0;
	pos_src		= 0;

	while (pos_src < buff_size) {
		line_len = alx_strnchrnul(src, '\n', buff_size - pos_src) + 1;
		if (strnstr(&(src[pos_src]), pattern, line_len)) {
			memcpy(&(dest[pos_dest]), &(src[pos_src]), line_len);
			pos_dest += line_len;
		}
		pos_src += line_len;
		if (src[pos_src - 1] == '\0')
			break;
	}

	dest[pos_dest]		= '\0';
	dest[buff_size - 1]	= '\0';

	return	pos_dest;
}


/******************************************************************************
 ******* static functions (definitions) ***************************************
 ******************************************************************************/


/******************************************************************************
 ******* end of file **********************************************************
 ******************************************************************************/
