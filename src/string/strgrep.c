/******************************************************************************
 *	Copyright (C) 2019	Alejandro Colomar Andr√©s		      *
 *	SPDX-License-Identifier:	LGPL-2.0-only			      *
 ******************************************************************************/


/******************************************************************************
 ******* headers **************************************************************
 ******************************************************************************/
#include "libalx/string/strgrep.h"

#include <stdbool.h>
#include <string.h>

#include <sys/types.h>

#include "libalx/string/strchr.h"


/******************************************************************************
 ******* macros ***************************************************************
 ******************************************************************************/


/******************************************************************************
 ******* enums ****************************************************************
 ******************************************************************************/


/******************************************************************************
 ******* structs / unions *****************************************************
 ******************************************************************************/


/******************************************************************************
 ******* variables ************************************************************
 ******************************************************************************/


/******************************************************************************
 ******* static functions (prototypes) ****************************************
 ******************************************************************************/


/******************************************************************************
 ******* global functions *****************************************************
 ******************************************************************************/
void	alx_strlgrep	(ssize_t buff_size,
			char dest[restrict buff_size],
			const char src[restrict buff_size],
			ssize_t key_size,
			const char key[restrict key_size])
{
	const ssize_t	key_len = strnlen(key, key_size);
	ssize_t	pos_dest;
	ssize_t	pos_src;
	ssize_t	line_len;

	pos_dest	= 0;
	pos_src		= 0;

	while (pos_src < buff_size) {
		line_len = alx_strnchrnul(src, '\n', buff_size - pos_src) + 1 -
									src;
		if (strnstr(&(src[pos_src]), key, key_len)) {
			memcpy(&(dest[pos_dest]), &(src[pos_src]), line_len);
			pos_dest += line_len;
		}
		pos_src += line_len;
	}

	memset(&(dest[pos_dest]), 0, buff_size - pos_dest);
	dest[buff_size - 1]	= '\0';
}


/******************************************************************************
 ******* static functions (definitions) ***************************************
 ******************************************************************************/


/******************************************************************************
 ******* end of file **********************************************************
 ******************************************************************************/
